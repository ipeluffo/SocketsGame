<!DOCTYPE html>
<html>
    <head>        
        <title>Sockets Game!</title>
        <meta charset='utf-8'> 

        <!-- Bootstrap dependencies -->
        <link rel="stylesheet" type="text/css" href="./css/bootstrap.css">
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script type="text/javascript" src="./js/bootstrap.js"></script>
        <!-- ********************** -->

        <!-- Socket dependencies -->
        <script src="/socket.io/socket.io.js"></script>
        <!-- ******************* -->

        <style type="text/css">
            .runButton {
                height: 55px;
                width: 70px;
                margin-right: 10px;
            }

            .container {
                width: 900px;
            }

            .userTrack {
                margin-bottom: 10px;
            }
        </style>

        <script type="text/javascript">
            var socket;
            var user;
            window.onload = function() {
                var welcome = document.getElementById("welcome");
                var allUsers = $("#users");
                var progress = document.getElementById("progress");
                var results = document.getElementById("results");

                socket = io.connect('http://'+window.location.hostname+':3250');

                socket.emit("userEnters", "");

                socket.on("userAccepted", function(data){
                    user = data;
                });

                socket.on('users', function (data) {
                    for (var i=0; i < data.users.length; i++){
                        var userHomer = $("#user"+data.users[i].id);
                        if (userHomer.length > 0){
                            // userHomer.animate({
                            //     "margin-left": data.users[i].clicks
                            // });
                            userHomer.css("margin-left", data.users[i].clicks);
                        }else{
                            allUsers.append('<div class="row-fluid userTrack"><div class="span12"><button class="btn btn-success runButton" onclick="sendClick();">Run Homer!</button><img id="user'+data.users[i].id+'" src="./img/run_homer_run.png" style="height:100px;"/></div></div><hr/>');
                        }
                    }
                });

                socket.on('update', function (data) {
                    progress.innerHTML = data.currentWidth;
                    progress.style.width = parseInt(data.currentWidth) + "px";
                });

                socket.on('win', function (data) {
                    results.innerHTML = data.message;
                });

            };

            function sendClick(){
                socket.emit("click", user);
            };

            $(function(){
                $('#usernameFormModal').modal({
                    backdrop: 'static',
                    keyboard: false
                });

                $("#usernameForm").submit(function(){
                    $("#usernameFormModal").modal("hide");
                    // Stop the normal action
                    return false;
                });
            });
        </script>
    </head>

    <body class="main">

        <div id="usernameFormModal" class="modal hide fade">
            <div class="modal-header">
                <h3>Welcome to Socket Baloons Game!</h3>
            </div>

            <div class="modal-body">
                <form id="usernameForm">
                    <fieldset>
                        <label>Nickname</label>
                        <input type="text" placeholder="Enter a great nicknameâ€¦" required>
                    </fieldset>
                </form>
            </div>

            <div class="modal-footer">
                <button onclick="$('#usernameForm').submit();" type="submit" class="btn">Play!</button>
            </div>
        </div>

        <div class="container">
            <div class="row-fluid">
                <div class="span12 well">
                    <h1>Welcome to SocketsGame!</h1>
                </div>
            </div>
        </div>

        <div id="users" class="container">
        </div>

    </body>
</html>

